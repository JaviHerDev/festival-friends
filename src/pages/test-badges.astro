---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Test Badges - Festival&Friends">
  <div class="min-h-screen bg-slate-900 text-white p-8">
    <h1 class="text-3xl font-bold mb-8">üß™ Test Badges Page</h1>
    
    <div id="badge-test" class="space-y-4">
      <div class="p-4 bg-slate-800 rounded-lg">
        <h2 class="text-xl font-semibold mb-4">Badge Loading Test</h2>
        <button 
          id="test-badges-btn"
          class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
        >
          Load Badges Directly
        </button>
        <div id="badge-results" class="mt-4 p-4 bg-slate-700 rounded-lg hidden">
          <h3 class="font-semibold mb-2">Results:</h3>
          <pre id="badge-data" class="text-sm text-green-400"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    import { supabase } from '../lib/supabase.js';

    const testBtn = document.getElementById('test-badges-btn');
    const resultsDiv = document.getElementById('badge-results');
    const dataDiv = document.getElementById('badge-data');

    if (testBtn) {
      testBtn.addEventListener('click', async () => {
        if (!resultsDiv || !dataDiv) return;
        
        try {
          console.log('üß™ Testing badge loading...');
          
          const { data, error } = await supabase
            .from('user_badges')
            .select(`
              *,
              badge_definitions (
                id,
                badge_key,
                name,
                description,
                icon,
                color_gradient,
                rarity,
                category
              ),
              festivals (
                id,
                name,
                start_date
              ),
              users!user_badges_awarded_by_fkey (
                id,
                name,
                nickname
              )
            `)
            .order('awarded_at', { ascending: false })
            .limit(10);

          if (error) {
            console.error('‚ùå Badge query error:', error);
            dataDiv.textContent = `Error: ${error.message}`;
            dataDiv.className = 'text-sm text-red-400';
          } else {
            console.log('‚úÖ Badge query success:', data?.length || 0, 'badges');
            dataDiv.textContent = JSON.stringify(data, null, 2);
            dataDiv.className = 'text-sm text-green-400';
          }
          
          resultsDiv.classList.remove('hidden');
        } catch (err) {
          console.error('‚ùå Badge query exception:', err);
          if (dataDiv) {
            dataDiv.textContent = `Exception: ${err.message}`;
            dataDiv.className = 'text-sm text-red-400';
          }
          if (resultsDiv) {
            resultsDiv.classList.remove('hidden');
          }
        }
      });
    }
  </script>
</Layout> 